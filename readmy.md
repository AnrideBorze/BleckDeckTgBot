Загальні

/start — привітання й підказка як почати.

/help — довідка з ключовими командами.

/id — показує chatId, userId і threadId (ID гілки).

/whoami — показує ваш userId, збережений нік і роль (гравець/координатор/адмін/власник).

Бот працює лише в дозволеному чаті і (за потреби) лише в дозволених гілках — контролюється змінними ALLOWED_CHAT_ID та ALLOWED_TOPIC_IDS у .env.

Нік та профіль

/setnick <нік> — прив’язує ваш Telegram-акаунт до канонічного ніку зі списку data!E:E.
Якщо ніку немає у вайтлисті — бот відповість: “Зверніться до адміністратора для добавлення вас в список гравців.”

Ваші колоди (6 слотів)

/deck — майстер з кнопками: вибір слота → вибір фракції зі списку data!B:B → введення сили (підтримка “1,1”=1.1M; “200,5”=200.5K).

/deck_set <1-6> <фракція> <сила> — швидке оновлення однією командою.

приклад: /deck_set 1 Легіон 333000

фракція має точно збігатися з одним із значень у data!B:B.

/deck_<1-6>_<фракція>_<сила> — дуже швидке оновлення без пробілів, пробіли замінюємо на _.

приклади:
/deck_1_Легіон_333000
/deck_4_Дикий_Ліс_1,1 (=> 1.1M)
/deck_5_Орден_200,5 (=> 200.5K)

/showme [нік] — показує 6 ваших колод (або вказаного ніку):
1, 2, 3, Боги (4), 1 резервна (5), 2 резервна (6), з силою.

Правила сили (усі команди)

1,1 → 1.1M → 1 100 000 (якщо десяткова частина і число < 100 — інтерпретуємо як мільйони).

200,5 → 200.5K → 200 500 (якщо десяткова частина і 100–999 — як тисячі).

333000 → 333000 (ціле без суфіксу — як є).

Працюють суфікси K/M (і К/М): 2M, 250K.

Бій та цілі

/fight [N] — видати цілі з аркуша “Планування”:

без параметрів — дає 4 цілі,

з числом 1..4 — рівно стільки цілей (наприклад, /fight 1).

Враховуються дозволи: у рядках Планування в стовпчику F має бути ваш нік (або ви присутні у списку ніків цього рядка).

Номер колоди для удару береться зі стовпчика G: 1..4 — звичайні колоди; 5–6 — боги (у відповіді буде підказка “бий: перша/друга/…/бог 1/бог 2”).

Після видачі цілі бот:

записує факт використання удару у ваш рядок листа “Наші колоди” в один із стовпчиків Y/Z/AA/AB (перший вільний), у форматі: перша/друга/…/бог → Будівля/Гравець;

у “Плануванні” в стовпчику H (status) ставить мітку знесли: <нік> (<колода>) <час>.

Якщо нік не встановлено — бот попросить зробити /setnick.

/enemies — показує лише живі (не знищені) ворожі колоди з “Планування” (читає з A3:H): групує по будівлі → гравець → перелік колод із силою. “Живою” вважається ціль зі порожнім H.

Противники: ведення бази

/enemy_set_<будівля>_<фракція>_<нік>_<гільдія>_<сила>[_<індекс>] — тільки для координаторів/адмінів/власника.
Додає/оновлює рядок у аркуш “Колоди противників”.

Поля мають збігатися зі списками в data:

Будівлі — data!A:A

Фракції — data!B:B

Ніки ворогів — data!C:C

Гільдії ворогів — data!D:D

сила — за правилами вище (підтримка K/M, десяткові як М/К).

Опційний _індекс — номер колоди ворога, якщо в одного гравця кілька колод в одній будівлі.

приклад:
/enemy_set_Башта_Легіон_ВорогНік_RedGuild_1,2_2

Ролі й доступ

(роль зберігаються локально у data/roles.json; власники — з OWNER_IDS у .env)

/admins — (адмін/власник) показує списки власників, адмінів, координаторів.

/grant_admin <userId> — (тільки власник) видати роль адмін. Можна реплаєм на повідомлення.

/revoke_admin <userId> — (тільки власник) забрати роль адмін.

/grant_coord <userId> — (адмін або власник) видати роль координатор.

/revoke_coord <userId> — (адмін або власник) забрати роль координатор.